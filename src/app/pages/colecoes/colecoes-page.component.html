<div class="colecoes-page">
  <div class="header">
    <div>
      <h1>Coleções</h1>
      <p>Agrupe seus links em coleções temáticas.</p>
    </div>
    <button class="primary-button" (click)="openCreateModal()">Nova coleção</button>
  </div>

  <div *ngIf="loading" class="loading">Carregando coleções...</div>

  <div class="collections-grid" *ngIf="!loading && colecoes?.length">
    <div class="collection-card" *ngFor="let c of colecoes">
      <div class="collection-header">
        <div>
          <h2>{{ c.name }}</h2>
          <p class="collection-description">
            {{ c.description || 'Sem descrição' }}
          </p>
        </div>
        <span class="badge">{{ c.visibility }}</span>
      </div>

      <div class="collection-footer">
        <button (click)="openEditModal(c)">Editar</button>
        <button class="danger" (click)="deleteCollection(c)">Excluir</button>
      </div>
    </div>
  </div>

  <p *ngIf="!loading && !colecoes?.length" class="empty-state">
    Nenhuma coleção cadastrada ainda. Clique em "Nova coleção" para começar.
  </p>

  <!-- MODAL -->
  <div class="modal-backdrop" *ngIf="isModalOpen">
    <div class="modal">
      <div class="modal-header">
        <h2>{{ editingCollection ? 'Editar coleção' : 'Nova coleção' }}</h2>
        <button class="modal-close" type="button" (click)="closeModal()">✕</button>
      </div>

      <form [formGroup]="colecaoForm" (ngSubmit)="saveCollection()">
        <label>
          Nome
          <input type="text" formControlName="name" />
        </label>

        <label>
          Descrição
          <textarea formControlName="description"></textarea>
        </label>

        <label>
          Visibilidade
          <select formControlName="visibility">
            <option value="publico">Público</option>
            <option value="restrito">Restrito</option>
            <option value="privado">Privado</option>
          </select>
        </label>

        <div class="links-selector" *ngIf="links?.length">
          <div class="links-selector-header">
            <span>Links desta coleção</span>
            <small>Marque os links que devem pertencer a esta coleção.</small>
          </div>

          <div class="links-selector-list">
            <label *ngFor="let link of links" class="links-selector-item">
              <input
                type="checkbox"
                [checked]="link.id ? selectedLinkIds.has(link.id.toString()) : false"
                (change)="onToggleLinkSelection(link, $event.target.checked)"
              />
              <div class="links-selector-text">
                <div class="title">{{ link.title || 'Sem título' }}</div>
                <div class="url">{{ link.short_url || link.url }}</div>
              </div>
            </label>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" (click)="closeModal()">Cancelar</button>
          <button type="submit" [disabled]="colecaoForm.invalid || saving">
            {{ saving ? 'Salvando...' : 'Salvar' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
